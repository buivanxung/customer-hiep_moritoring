<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <!-- Required meta tags -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title> Technology</title>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/modernizr-3.5.0.min.js"></script>
    <script src="js/jquery-1.12.4.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
      var socket;
      var c_connect = true;
  	  var r_status = true;
      var maxTemp=0,minTemp=0,maxCond=0,minCond=0,maxOxy=0,minOxy=0,maxPH=0,minPH=0;
      var imaxTemp='',iminTemp='',imaxCond='',iminCond='',imaxOxy='',iminOxy='',imaxPH='',iminPH='';
      $(document).ready(function()
        {
          $('#temp1').html("0 oC");
          $('#conduc1').html("0 (o/00)");
          $('#oxy1').html("0 (mg/L)");
          $('#ph1').html("0");
          $('#status').html("Đang kết nối");
          $('#T').html("0 - 0");
           $('#C').html("0 - 0");
           $('#P').html("0 - 0");
           $('#O').html("0 - 0");
          socket = io.connect('http://103.15.51.143:5000',{
            reconnection: true,
            reconnectionDelay: 1000,
            reconnectionDelayMax : 5000,
            reconnectionAttempts: 99999
          });
  				socket.on('server_feedback', function (data) {
            var res = data.split(",");
            var tempt = res[0].split("=");
            var tempt_v = tempt[1];
            var cond = res[1].split("=");
            var cond_v = cond[1];
            var oxy = res[2].split("=");
            var oxy_v = oxy[1];
            var ph = res[3].split("=");
            var ph_v = ph[1];
            var bat = res[4].split("=");
            var bat_v = bat[1];
            $('#temp1').html(tempt_v + "oC");
            $('#conduc1').html(cond_v + "(o/00)");
            $('#oxy1').html(oxy_v +"(mg/L)");
            $('#ph1').html(ph_v);
            console.log(res);
  				});
          socket.on('server_status', function(data) {
            if (data == "R" ) {
              $('#status').html("Trạng thái bơm: Đang chạy");
            } else if (data == "S" ) {
              $('#status').html("Trạng thái bơm: Đang Tắt");
            }
            if (data == "R" && r_status == false) {
              $("input[name='run']").attr("disabled", "disabled");
              $("input[name='stop']").removeAttr("disabled");
            } else if (data == "S" && r_status == false) {
              $("input[name='stop']").attr("disabled", "disabled");
              $("input[name='run']").removeAttr("disabled");
            }
            console.log(data);
          });
          socket.on('server_control_status', function(data) {
            c_connect = false;
            if (data == "F") {
              r_status = false;
              $("input[name='manual']").removeAttr("disabled");
            } else if (data == "T") {
              r_status = true;
              $("input[name='run']").attr("disabled", "disabled");
              $("input[name='stop']").attr("disabled", "disabled");
              $("input[name='manual']").removeAttr("disabled");
            }
            console.log(data);
          });
          socket.on('server_update_web', function(data) {
            var res = data.split("/");
            var xT = res[0].split(":");
            var nT = res[1].split(":");
            var xC = res[2].split(":");
            var nC = res[3].split(":");
            var xO = res[4].split(":");
            var nO = res[5].split(":");
            var xP = res[6].split(":");
            var nP = res[7].split(":");
            $('#T').html(nT[1]+ "-" + xT[1]);
            $('#C').html(nC[1]+ "-" + xC[1]);
            $('#O').html(nO[1]+ "-" + xO[1]);
            $('#P').html(nP[1]+ "-" + xP[1]);
          });

          $('input').on('click', function() {
           imaxTemp = $('#maxTemp').val();
           iminTemp = $('#minTemp').val();
           imaxCond = $('#maxCond').val();
           iminCond = $('#minCond').val();
           imaxOxy = $('#maxOxy').val();
           iminOxy = $('#minOxy').val();
           imaxPH = $('#maxPH').val();
           iminPH = $('#minPH').val();
           if (imaxTemp =='' || iminTemp =='' || imaxCond =='' || iminCond =='' || imaxOxy =='' || iminOxy == '' || imaxPH == '' || iminPH =='') {
             $("#mode_update").prop("disabled", true);
           }else {
             $("#mode_update").removeAttr('disabled');
           }
         });
          setInterval(function () {
            if (r_status == true) {
              $('#mode').html("Mode: Tự động");
              $("input[name='manual']").val('Bằng Tay');
            } else {
              $('#mode').html("Mode: Điều khiển bằng tay");
                $("input[name='manual']").val('Tự động');
            }
          }, 1000);
          setInterval(function () {
            if (c_connect == true) {
              location.reload(true);
            }
          }, 120000);
          setInterval(function () {
            var raw_time = new Date();
            if (raw_time.getMinutes() < 10) {
              $('#time').html(raw_time.getHours()+":0"+(raw_time.getMinutes()));
            } else {
              $('#time').html(raw_time.getHours()+":"+(raw_time.getMinutes()));
            }
          }, 100);
        });

        function run() {
          if (socket) {
  					socket.emit('server_web_control', "R");
  				}
          if (r_status == false) {
             $("input[name='run']").attr("disabled", "disabled");
             $("input[name='stop']").removeAttr("disabled");
             $('#status').html("Máy Đang Bơm");
          }
          return true;
        }
        function stop() {
            if (socket) {
  					socket.emit('server_web_control', "S");
  				 }
           if (r_status == false) {
             $("input[name='run']").removeAttr("disabled");
             $("input[name='stop']").attr("disabled", "disabled");
             $('#status').html("Máy Đang Tắt");
           }
           return true;
        }
        function manual() {
          if (r_status == true) {
            status = false;
            if (socket) {
            socket.emit('server_web_status', "M");
            }
            $("input[name='manual']").attr("disabled", "disabled");
          }else {
            r_status = true;
              if (socket) {
                socket.emit('server_web_status', "A");
              }
            $("input[name='manual']").attr("disabled", "disabled");
          }
  	       console.log(r_status);
         return true;
        }
        function update_mix() {
          var data = "xT:" + imaxTemp + "/" + "nT:" + iminTemp + "/" + "xC:" + imaxCond + "/" + "nC:" + iminCond  + "/" + "xO:" + imaxOxy + "/" + "nO:" + iminOxy + "/" +  "xP:" + imaxPH + "/" + "nP:" + iminPH + "/";
          console.log(data);
          if (socket) {
  					socket.emit('web_update', data);
             $('#maxTemp').val()=null;
             $('#minTemp').val()=null;
             $('#maxCond').val()=null;
             $('#minCond').val()=null;
             $('#maxOxy').val()=null;
             $('#minOxy').val()=null;
             $('#maxPH').val()=null;
             $('#minPH').val()=null;
             $("#mode_update").prop("disabled", true);
  				}
          return true;
        }
    </script>
    <style>
* {
  box-sizing: border-box;
}
.menu {
  float: left;
  width: 20%;
}
.menuitem {
  padding: 8px;
  margin-top: 7px;
  border-bottom: 1px solid #f1f1f1;
}
.main {
  float: left;
  width: 60%;
  padding: 0 20px;
  overflow: hidden;
}
.right {
  background-color: lightblue;
  float: left;
  width: 20%;
  padding: 10px 15px;
  margin-top: 7px;
}

@media only screen and (max-width:800px) {
  /* For tablets: */
  .main {
    width: 80%;
    padding: 0;
  }
  .right {
    width: 100%;
  }
}
@media only screen and (max-width:500px) {
  /* For mobile phones: */
  .menu, .main, .right {
    width: 100%;
  }
}
</style>
</head>
<body style="font-family:Verdana;">
  <div style="background-color:#f1f1f1;padding:15px; text-align: center;">
    <label ><span><strong><font size = "7">HỆ THỐNG ĐIỀU KHIỂN VÀ GIÁM SÁT CHẤT LƯỢNG NƯỚC THỦY SẢN</font></strong></span></label>
</div>
<div class="container-fluid pb-4 pt-4 paddding">
  <table>
    <tr>
      <table align="center" >
        <th>
          <div  align="center">
            <label style="color:DodgerBlue;"><font size = "5"><span id="status"></font> </span></label>
          </div>
          <div align="center">
            <input type="submit" name="run" value="Bật PUMP" onclick="return run();" size="5">
            <input type="submit" name="stop" value="Tắt PUMP" onclick="return stop();" size="5">
            <input type="submit" name="manual" value="Tự động" onclick="return manual();" size="5">
          </div>
          <div  align="center">
            <label style="color:DodgerBlue;"><font size = "5"><span id="mode"></font> </span></label>
          </div>
        </th>
      </table>
    </tr>
    <tr>
      <table align="center" >
        <th>
          <h1 style="color:DodgerBlack;"><font size = "20"><strong><span id="time"></span></strong></font> </h1>
        </th>
      </table>
    </tr>
    <tr>
      <table style="width: 100%; align: center;" >
        <tr>
          <th> <center> <font size = "10" color="#b30059">  Nhiệt độ </font></center></th>
          <th> <center> <font size = "10" color="#b30059"> Độ mặn  </font></center></th>
          <th> <center> <font size = "10" color="#b30059"> Oxy </font><center></th>
          <th> <center> <font size = "10" color="#b30059"> PH</font></center></th>
        </tr>
        <tr style="align: center;">
          <td style="width: 25%; ">
            <div align="center">
            <label><center><strong><font size = "10"><span id="temp1"></span></font></strong></center></label>
            </div>
          </td>
          <td style="width: 25%;">
            <div align="center">
                <label><center><strong><font size = "10"><span id="conduc1"></span></font></strong></center></label>
            </div>
          </td>
          <td style="width: 25%;">
            <div align="center">
            <label><center><strong><font size = "10"><span id="oxy1"></span></font></strong></center></label>
            </div>
          </td>
          <td style="width: 25%;">
            <div align="center">
            <label><center><strong><font size = "10"><span id="ph1"></span></font></strong></center></label>
            </div>
          </td>
        </tr>
      </table>
    </tr>
  </table>
</div>
<div class="container-fluid fh5co_footer_right_reserved">
    <div class="container">
        <div class="row  ">
            <div class="col-12 col-md-6 py-4 Reserved"><font size = "4"> <strong>Ngưỡng cảnh báo hiện tại:<strong></font> </div>
    </div>
</div>
<div class="container-fluid pb-4 pt-4 paddding">
  <table style="width: 100%; align: center;" >
    <tr>
      <th> <center> <font size = "4" color="#47476b">  Nhiệt độ (oC) </font></center></th>
      <th> <center> <font size = "4" color="#47476b"> Độ mặn (o/00) </font></center></th>
      <th> <center> <font size = "4" color="#47476b"> Oxy (mg/L)</font><center></th>
      <th> <center> <font size = "4" color="#47476b"> pH</font></center></th>
    </tr>
    <tr style="align: center;">
      <td style="width: 25%; ">
        <div align="center">
        <label><center><strong><font size = "6"><span id="T"></span></font></strong></center></label>
        </div>
      </td>
      <td style="width: 25%;">
        <div align="center">
            <label><center><strong><font size = "6"><span id="C"></span></font></strong></center></label>
        </div>
      </td>
      <td style="width: 25%;">
        <div align="center">
        <label><center><strong><font size = "6"><span id="O"></span></font></strong></center></label>
        </div>
      </td>
      <td style="width: 25%;">
        <div align="center">
        <label><center><strong><font size = "6"><span id="P"></span></font></strong></center></label>
        </div>
      </td>
    </tr>
  </table>
</div>
<button type="button" class="btn btn-primary" data-toggle="collapse" data-target="#update"> Cập Nhật Ngưỡng Cảnh Báo</button>
<div  id="update" class="collapse" >
  <table style=" width: 70%; margin: 0 auto;text-align:center" >
    <tr style="align: center;">
      <th>
        <div class="form-group">
          <div style="text-align: center">
            <label for=""> <strong>Nhiệt độ<strong></label>
          </div>
          <label for="usr">Max:</label>
          <input id="maxTemp" type="number" step="0.1" class="form-control" size="30" min="20" max="100">
        </div>
        <div class="form-group">
          <label for="pwd">Min:</label>
          <input id="minTemp" type="number" step="0.1" class="form-control" size="30" min="15" max="50">
        </div>
      </th>
      <th>
        <div class="form-group">
          <div style="text-align: center">
            <label for=""> <strong>Độ mặn<strong></label>
          </div>
          <label for="usr">Max:</label>
          <input id="maxCond" type="number" step="0.1" class="form-control" size="30" min="10" max="80">
        </div>
        <div class="form-group">
          <label for="pwd">Min:</label>
          <input id="minCond" type="number" step="0.1" class="form-control" size="30" min="1" max="80">
        </div>
      </th>
      <th>
        <div class="form-group">
          <div style="text-align: center">
            <label for=""> <strong>Oxy<strong></label>
          </div>
          <label for="usr">Max:</label>
        <input id="maxOxy" type="number" step="0.01" class="form-control" size="30" min="1" max="100">
        </div>
        <div class="form-group">
          <label for="pwd">Min:</label>
          <input id="minOxy" type="number" step="0.01" class="form-control" size="30" min="1" max="100">
        </div>
      </th>
      <th>
        <div class="form-group">
          <div style="text-align: center">
              <label for=""> <strong>pH<strong></label>
          </div>
          <label for="usr">Max:</label>
          <input id="maxPH" type="number" step="0.1" class="form-control" size="30" min="1" max="14">
        </div>
        <div class="form-group">
          <label for="pwd">Min:</label>
          <input id="minPH" type="number" step="0.1" class="form-control" size="30" min="1" max="14">
        </div>
      </th>
      <th style="align: center;">
        <div style="text-align: center">
          <button type="button" name="button"  id="mode_update" class="btn btn-info btn-lg" onclick = "update_mix()">Gửi đi</button>
        </th>
        </div>
    </tr>
  </table>
</div>
<div class="container-fluid fh5co_footer_right_reserved">
    <div class="container">
        <div class="row  ">
            <div class="col-12 col-md-8 py-4 Reserved"> Một sản phẩm IoT của CÔNG TY CỔ PHẦN PHÂN PHỐI CÔNG NGHỆ <strong>PHA </strong> VIỆT NAM  </div>
        </div>
    </div>
</div>
<div class="gototop js-top">
    <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
</body>
</html>
