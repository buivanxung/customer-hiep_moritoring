<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <!-- Required meta tags -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> Technology</title>
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script src="js/modernizr-3.5.0.min.js"></script>
    <script src="js/jquery-1.12.4.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
    var socket;
    var c_connect = true;
	  var r_status = true;
    $(document).ready(function()
      {
        $('#temp1').html("0 (oC)");
        $('#conduc1').html("0 (o/00)");
        $('#oxy1').html("0 (mg/L)");
        $('#ph1').html("0");
        $('#status').html("Đang kết nối");
        socket = io.connect('http://localhost:5000',{
          reconnection: true,
          reconnectionDelay: 1000,
          reconnectionDelayMax : 5000,
          reconnectionAttempts: 99999
        });
				socket.on('feedback', function (data) {
          var res = data.split(",");
          var tempt = res[0].split("=");
          var tempt_v = tempt[1];
          var cond = res[1].split("=");
          var cond_v = cond[1];
          var oxy = res[2].split("=");
          var oxy_v = oxy[1];
          var ph = res[3].split("=");
          var ph_v = ph[1];
          var bat = res[4].split("=");
          var bat_v = bat[1];
          $('#temp1').html(tempt_v + "(oC)");
          $('#conduc1').html(cond_v + "(o/00)");
          $('#oxy1').html(oxy_v +"(mg/L)");
          $('#ph1').html(ph_v);
          console.log(res);
				});
        socket.on('status', function(data) {
          if (data == "R" ) {
            $('#status').html("Trạng thái bơm: Đang chạy");
          } else if (data == "S" ) {
            $('#status').html("Trạng thái bơm: Đang Tắt");
          }
          if (data == "R" && r_status == false) {
            $("input[name='run']").attr("disabled", "disabled");
            $("input[name='stop']").removeAttr("disabled");
          } else if (data == "S" && r_status == false) {
            $("input[name='stop']").attr("disabled", "disabled");
            $("input[name='run']").removeAttr("disabled");
          }
          console.log(data);
        });
        socket.on('control_status', function(data) {
          c_connect = false;
          if (data == "F") {
            r_status = false;
            $("input[name='manual']").removeAttr("disabled");
          } else if (data == "T") {
            r_status = true;
            $("input[name='run']").attr("disabled", "disabled");
            $("input[name='stop']").attr("disabled", "disabled");
            $("input[name='manual']").removeAttr("disabled");
          }
          console.log(data);
        });
        setInterval(function () {
          if (r_status == true) {
            $('#mode').html("Mode: Tự động");
            $("input[name='manual']").val('Bằng Tay');
          } else {
            $('#mode').html("Mode: Điều khiển bằng tay");
              $("input[name='manual']").val('Tự động');
          }
        }, 1000);
        setInterval(function () {
          if (c_connect == true) {
            location.reload(true);
          }
        }, 120000);
        setInterval(function () {
          var raw_time = new Date();
          $('#time').html(raw_time.getHours()+":"+(raw_time.getMinutes()));
        }, 100);
      });

      function run() {
        if (socket) {
					socket.emit('web_control', "R");
				}
        if (r_status == false) {
           $("input[name='run']").attr("disabled", "disabled");
           $("input[name='stop']").removeAttr("disabled");
           $('#status').html("Máy Đang Bơm");
        }
        return true;
      }
      function stop() {
          if (socket) {
					socket.emit('web_control', "S");
				 }
         if (r_status == false) {
           $("input[name='run']").removeAttr("disabled");
           $("input[name='stop']").attr("disabled", "disabled");
           $('#status').html("Máy Đang Tắt");
         }
         return true;
      }
      function manual() {
        if (r_status == true) {
          status = false;
          if (socket) {
          socket.emit('web_status', "M");
          }
          $("input[name='manual']").attr("disabled", "disabled");
        }else {
          r_status = true;
            if (socket) {
              socket.emit('web_status', "A");
            }
          $("input[name='manual']").attr("disabled", "disabled");
        }
	console.log(r_status);
       return true;
      }
    </script>
</head>
<body>
<div class="container-fluid pb-4 pt-4 paddding">
  <table>
    <tr>
      <table align="center" >
        <th>
          <div>
            <label ><span><strong><font size = "100">Trình trạng bơm</font></strong></span></label>
          </div>
          <div  align="center">
            <label style="color:DodgerBlue;"><font size = "5"><span id="status"></font> </span></label>
          </div>
          <div align="center">
            <input type="submit" name="run" value="Bật PUMP" onclick="return run();" size="5">
            <input type="submit" name="stop" value="Tắt PUMP" onclick="return stop();" size="5">
            <input type="submit" name="manual" value="Tự động" onclick="return manual();" size="5">
          </div>
          <div  align="center">
            <label style="color:DodgerBlue;"><font size = "5"><span id="mode"></font> </span></label>
          </div>
        </th>
      </table>
    </tr>
    <tr>
      <table align="center" >
        <th>
          <h1 style="color:DodgerBlack;"><font size = "20"><strong><span id="time"></span></strong></font> </h1>
        </th>
      </table>
    </tr>
    <tr>
      <table style="width: 100%; align: center;" >
        <tr>
          <th> <center> <font size = "10" color="#b30059">  Nhiệt độ </font></center></th>
          <th> <center> <font size = "10" color="#b30059"> Độ mặn  </font></center></th>
          <th> <center> <font size = "10" color="#b30059"> Oxy </font><center></th>
          <th> <center> <font size = "10" color="#b30059"> pH</font></center></th>
        </tr>
        <tr style="align: center;">
          <td style="width: 25%; ">
            <div align="center">
            <label><center><strong><font size = "10"><span id="temp1"></span></font></strong></center></label>
            </div>
          </td>
          <td style="width: 25%;">
            <div align="center">
                <label><center><strong><font size = "10"><span id="conduc1"></span></font></strong></center></label>
            </div>
          </td>
          <td style="width: 25%;">
            <div align="center">
            <label><center><strong><font size = "10"><span id="oxy1"></span></font></strong></center></label>
            </div>
          </td>
          <td style="width: 25%;">
            <div align="center">
            <label><center><strong><font size = "10"><span id="ph1"></span></font></strong></center></label>
            </div>
          </td>
        </tr>
      </table>
    </tr>
  </table>
</div>
<div class="container-fluid fh5co_footer_right_reserved">
    <div class="container">
        <div class="row  ">
            <div class="col-12 col-md-6 py-4 Reserved"> IOT Smart Water - <strong>PHA </strong> - <strong>Distribution Company </strong> </div>
            <div class="col-12 col-md-6 spdp_right py-4">
        </div>
    </div>
</div>
<div class="gototop js-top">
    <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
</body>
</html>
